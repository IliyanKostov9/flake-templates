name: Flake ‚ùÑÔ∏è

on:
  schedule:
    - cron: "0 0 */14 * *"
  workflow_dispatch:

env:
  FLAKE_PATH: ./templates/flake-parts

jobs:
  flake:
    name: Flake ‚ùÑÔ∏è
    runs-on: ubuntu-24.04
    strategy:
      matrix:
        flakes: ["empty", "java", "javascript", "python"]
    steps:
      - uses: actions/checkout@v6
        with:
          fetch-depth: 0
      - uses: DeterminateSystems/nix-installer-action@v21
      - uses: cachix/cachix-action@v16
        with:
          name: flake-templates
          authToken: "${{ secrets.CACHIX_AUTH_TOKEN }}"

      - name: Lock üîíÔ∏è
        uses: DeterminateSystems/flake-checker-action@v12
        with:
          flake-lock-path: ${{ env.FLAKE_PATH }}/${{ matrix.flakes }}/flake.lock

      - name: Updater ‚ú®
        uses: DeterminateSystems/update-flake-lock@v28
        if: ${{ github.event_name != 'pull_request' }}
        with:
          pr-title: "chore: update flake.lock"
          path-to-flake-dir: ${{ env.FLAKE_PATH }}/${{ matrix.flakes }}/
          pr-labels: |
            dependencies
            automated
          token: ${{ secrets.GIT_PR_PUSH_UPDATES_CI }}
